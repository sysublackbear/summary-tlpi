### Chapter2.基本概念

#### 1.内核的含义

含义：管理和分配计算机资源（CPU，RAM和设备）的核心层软件。



#### 2.内核的职责

+ 进程调度：linux属于抢占式多任务操作系统；
+ 内存管理：进程与进程，进程与内核相互隔离；
+ 提供文件系统；
+ 创建和终止进程；
+ 对外围设备的访问；
+ 联网；
+ 提供系统调用应用程序接口（API）。



#### 3.用户态和内核态相互切换

用户态只关心自身进程的逻辑，而内核态执行资源分配和进程调度。内核掌管CPU的使用，何时接管什么进程等，文件系统，进程间通信等。



#### 4.静态库和动态库

静态库是对已编译目标模块的一种结构化整合。要使用静态库中的函数，需要在创建程序的链接命令中指定相应的库。主程序会对静态库中隶属于各自目标模块的不同函数加以引用。链接器在解析了引用情况后，会从库中抽取所需要目标模块的副本，将其复制到最终的可执行文件中，这是所谓的静态链接。



如果将程序链接到共享库，那么链接器就不会把库中的目标模块复制到可执行文件中，而是在可执行文件中写入一条记录，以表明可执行文件在运行时需要使用该共享库。一旦在运行时将可执行文件载入内存，“动态链接器”的程序会确保将可执行文件所需的动态库找到，并载入内存，随后实施运行时链接，解析可执行文件中的函数调用，将其与共享库中相应的函数定义关联起来。在运行时，共享库代码在内存只需保留一份，且可供所有运行中的程序使用。



#### 5.进程间通信的方式

+ 信号（signal）；
+ 管道和FIFO（命名管道）；
+ 套接字（Socket）；
+ 文件锁定（flock）；
+ 消息队列；
+ 信号量（semaphore）；
+ 共享内存。



#### 6.线程

每个进程都可执行多个线程。可将线程想象为共享同一虚拟内存及一干其他属性的进程。每个线程都会执行相同的程序代码，共享同一数据区域和堆。可是，每个线程都拥有属于自己的栈，用来装载本地变量和函数调用链接信息。



线程之间可通过共享的全局变量进行通信。借助于线程API所提供的条件变量和互斥机制，进程所属的线程之间得以相互通信并同步行为——尤其是在对共享变量的使用方面。此外，线程间也能彼此通信。



线程的主要优点在于协同线程之间的数据共享（通过全局变量）更为容易，而且就某些算法而论，以多线程来实现比之以多进程实现要更加自然。再者，多线程应用能从多处理器硬件的并行处理中受益匪浅。



#### 7.进程组合shell任务控制

shell执行的每个程序都会在一个新进场内发起。比如，shell 创建了3个进程来执行以下管道命令：

```shell
$ ls -l | sort -k5n | less
```

主流的shell都提供了一种交互式特性，名为任务控制。该特性允许用户同时执行并操纵多条命令或管道。在支持任务控制的shell中，会将管道内的所有进程置于一个新进程组或任务中。（如果情况很简单，shell命令行只包含一条命令，那么就会创建一个只包含单个进程的新进程组。）进程组中的每个进程都具有相同的进程标识符（以整数形式），其实就是进程组中某个进程（也称为进程组组长 process group leader）的进程ID。

内核可对进程组中的所有成员执行各种动作，尤其是信号的传递。支持任务控制的shell 会利用这一特性，以挂起或恢复执行管道中的所有进程。



#### 8.会话，控制终端和控制进程

会话是指一组进程组（任务）。会话中的所有进程都具有相同的会话标识符。会话首进程是指创建会话的进程，其进程ID会成为会话ID。

使用会话最多的是支持任务控制的shell，由shell 创建的所有进程组与shell 自身隶属于同一会话，shell是此会话的会话首进程。

通常，会话都会与某个控制终端相关。控制终端建立于会话首进程初次打开终端设备之时。对于由交互式shell 所创建的会话，这恰恰是用户的登录终端，一个终端至多只能成为一个会话的控制终端。

打开控制终端会致使会话首进程成为终端的控制进程。一旦断开了与终端的连接（比如，关闭了终端窗口），控制进程将会收到SIGHUP信号。

在任一时点，会话中总有一个前台进程组（前台任务），可以从终端中读取输入，向终端发送输出。如果用户在控制终端中输入了“中断“（Control-c）或者”挂起“字符（Control-z），那么终端驱动程序会发送信号以终止或挂起前台进程组。一个会话可以拥有任意数量的后台进程组（后台任务），由以"&"字符结尾的行命令来实现。

支持任务控制的shell提供如下命令：列出所有任务，向任务发送信号，以及在前后台任务之间来回切换。



#### 9.日期和时间

进程涉及两种时间：

+ 真实时间：指的是在进程的生命期内，以某个标准时间点或固定时间点为起点测量得出的时间。
+ 进程时间：亦称CPU时间，指的是进程自启动起来，所占用CPU时间总量。可进一步将CPU时间划分为系统CPU时间和用户CPU时间。





